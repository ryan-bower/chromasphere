<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Chromosphere</title>
    <link rel="shortcut icon" href="favicon.ico" type="image/vnd.microsoft.icon">
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=font1|font2|etc" type="text/css">
    <link rel="stylesheet" href="styles.css" type="text/css">
</head>

<div id="map" onclick="goToNextPlanet()"><img></div>

<div id="planet-wrapper">
    <div id="planet"></div>
</div>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
<script src="//cdn.jsdelivr.net/sweep/latest/mainfile">
    console.log("sweep loaded");
</script>
<script type="text/javascript">
    // data constants
    const planets = [
        {
            name:'green',
            colorLow:'#92A439',
            colorHigh:'#2A7750'
        },{
            name:'red',
            colorLow:'#AA5939',
            colorHigh:'#983352'
        },{
            name:'purple',
            colorLow:'#6F256F',
            colorHigh:'#4B2D73'
        },{
            name:'blue',
            colorLow:'#294F6D',
            colorHigh:'#343477'
        },{
            name:'orange',
            colorLow:'#AA7939',
            colorHigh:'#AA5939'
        },{
            name:'gold',
            colorLow:'#AAA039',
            colorHigh:'#91A437'
        }
    ];
    const lexiaParts = ['lexia-start', 'lexia-a', 'lexia-b', 'lexia-end', 'lexia-bad'];
    /*
    var lexias = [{
        name: 'green',
        lexiaStart: 'Lee felt a gentle shake from outside his covers. Despite barely being able to fall asleep from excitement the night before, his mind turned wide awake. He them away revealing his big brother smiling overtop of him. “It’s time?!” Kai looked up at the ceiling where Lee’s clock projected the hour. “5:17, fifteen minutes until the solar event. You getting up or what?” He sprung out of bed and bound past him, making a break for the kitchen.\n' + '\n' + 'He and Kai had been planning his morning for months, ever since Kai had told him about the synchro-aligned sunrise that would occur with their two suns. He had used a chart to show Lee how the suns rotate around each other at a different axis than their planet. Once every 156 sols, the two lineup perfectly and cause successive sunrises over the course of a few minutes. After breakfast the two headed up to the rooftop patio, their view expanding to the entire city of Viridis from atop the 112 story overgrown skyscraper they call home.\n' + '\n' + 'All around them stood remininents of the economy driven civilization that came before them. Massive buildings with hundreds of windows to offices and conference rooms, now almost entirely residential. Green vines poured down the sides of the structures, ferns and other flora were blooming on every window sill, wherever there was space. Reminders of the priority on life. Lee started jumping up and down, “Is that it?! I think it’s starting!” Kai’s face turned cold for a moment, as scanning the horizon always did to him. Outside of the city limits it was a barren wasteland, devoid of life. Massive craters and scorched land made sure that one forgot the war that had come many decades before them. The light began to intensify and collect into one spot out in the distance, where the torn earth met the sky. A small ball of intense light peeked out over it, then slowly dipped back down. Lee gasped in wonder, the light was slowly intensifying and diminishing as the suns swung around each other. A second sunrise, higher than the first, breathed more light. This time it began to set, and rise at the same time, Lee was unsure if this sun had split entirely in half...\n',
        lexiaEnd: 'Lee found himself staring out the window, as he had been doing a lot lately. He watched Bernard as he basked in the sun on the rooftop, taking an occasional swig from the flask concealed in his vest. Lee could never read his facial expressions, though it was likely because Bernard was a Koala and didn’t have human features. It’d been only hours since he landed, but with each story he recounted about Kai, Lee trusted the bear more. And what other choice did he have? He must go out in search of his brother.\n' + '\n' + 'Lee’s expression furrowed into as fierce of a look as he could muster, and grabbed the bag he had packed. He marched up to Bernards tanning spot and stopped with his hands balled in fists. “We’re going to find him.” The Koala continued to lie, taking in a few last moments of sun. He grunted, “What do you mean?” Lee puffed, and marched past him towards the ship’s boarding ramp. Bernard sprung out of his seat, scuttering after him “Wait, Lee, where are you going?” He followed as Lee disappeared into the rocket ship.\n' + '\n' + 'Though his brother had shown him pictures, and described all of its features dozens of times, Lee still looked around in total wonder. There was advanced technology floor to ceiling of the place. Sensors, meters, switches, lights, monitors! After never being permitted to visit the launch facility, he could finally touch it. He made his way to the navigation console and traced his finger along the curved edge of the desk. How many hours had Kai sat right here?\n' + '\n' + 'Bernard watched from the door as Lee wandered into the sleeping quarters. A plaid flannel laid limp on the bunk, Lee slammed his face into it and inhaled deep. The smell was overwhelmingly familiar. His eyes were wet as walked back to the main room. “Are we good for takeoff? How can I help?” Bernard sighed, “It’s a terrible thing Lee, I know. But he’s gone.” Lee nodded. “Then take me where he went.”\n',
        lexiaA:'The day that Lee’s big brother had to leave was one of the hardest. He knew it was important, he knew that Kai had been working towards this all his life. He had always known that the day would come, but it was too hard to believe that it was here. There was a knock and Lee gasped quietly, flicking his eyes up from the most recent issue of the “Cosmonaut Heroes” comic book. “Lee, I need you to tie these bud.” Kai’s voice softly came through wooden door. He felt a soft tinge of nausea but did his best to look happy as he opened it and saw his big brother smiling down at him. Lee made quick work of the laces on Kai’s boots, a ritual he had mastered over years of sending his brother off to the academy each day. He wondered if Kai would even remember how to tie them once he was on his own.\n' + '\n' + '“Thanks bud, now give me a hug. I’m gonna be back in no time, okay?” Lee leaned in and tried to take in all of Kai, his smell, the texture of his leather coat, the sound of his breath. Three months is certainly not “no time”, to Lee it seemed like it’d be a lifetime. He squeezed his eyes tight, to the point where they started to sting. “You’re gonna write me everyday, right Kai? That’s what you said.” Kai held him out at arm’s reach, chuckling. “I did say that. I’ll do my best, but you know some days will be very busy.” Lee nodded. “Now take care of Miss Monica for me until I get back.” Lee nodded again as Kai rustled his hair and grabbed his bag from the floor. \n',
        lexiaB:'Lee waited impatiently for the notification about the status of the package. Kai’s souvenirs were always delivered at 9:00am every other Tuesday, but that day had already come and passed. So had Wednesday and Thursday. He was starting to wonder if it wasn’t going to get here until the following week, how disappointing. Gifts from Kai were one of the most looked forward to moments of the week! Lee heard a muffled clang as something heavy seemed to drop onto the roof, a few floors above him. After a moment he heard a buzz at the front door, and voice, “There is a transit waiting for Apartment 109C via the roof access.” Confused, Lee carefully grabbed his backpack full of the past gifts from Kai and peeked out the door. Surely Miss Monica wouldn’t notice if he was gone for a few minutes, he was usually stowed away in his room reading comics for the early hours of the morning anyway. As he opened the door he could hear the rumbling of an engine and to his surprise, Kai’s interplanetary ship! It didn’t make any sense, Lee wasn’t due back for another three weeks. Maybe he had to come home early…\n' + '\n' + 'Before he could make a move towards the vessel, a door on the side pneumatically opened with a hiss, and a small ramp descended to the patio floor. Through the out flowing smokey mist a tiny creature waddled out. It seemed to be an animal that Lee had read about from one of the more dangerous areas of the world, a small Koala bear with a matted gray coat. Atop its head bounced an aviator helmet as he waddled over to the boy. Lee stood in disbelief at the ridiculous sight of the bear bounding towards him on his two, tiny back paws. “Lee! You must be Lee, you look just like the pictures! How are you friend?” He couldn’t even respond, his mouth just fell agape. “I’m Bernard, a friend of Kai’s. Take a seat here bud, I’ll have to explain all this.\n' + '\n' + '“I’ve come a long way to deliver some very bad news. I promised him I would. Lee, your brother is dead.” The words bounced off Lee’s ears in dissonance, they sounded so foreign and confusing. His mouth and eyes changed to slits, he tried to respond, but couldn’t move. Bernard gave him a sympathetic look, “I’m real sorry mate, he was a good lad.” Lee raised his arms over his head, placing his hands on the soft fro of hair atop him. “What do you mean though? Where is he?” The Koala sighed, pushing a chair up next to him and climbing up into it. He pulled out a small flask, took a swig, and began to recount the story of Kai’s final adventure.\n',
        lexiaBad:'You died! :o'
    }];
    */
    // player progress
    var currPlanet = "green";
    var currLexia = "lexia-start";

    // Runs on DOM ready
    function autorun()
    {
        console.log("The application has started properly.");
        // set the initial background image
        setMapImage(0);
    }

    // changes the background image
    function setMapImage(mapNum) {
        document.getElementById('map').getElementsByTagName('img')[0].src= 'assets/imgs/map'+ mapNum +'.jpg';
    }

    // returns the user to the map
    function goToMap() {
        // show the map
        document.getElementById("map").style.display = 'block';
        // hide the planet
        document.getElementById("planet").style.display = 'none';
    }

    // triggered when the user clicks the map
    function goToNextPlanet() {
        var map = document.getElementById("map");
        var planet = document.getElementById("planet");

        //hide the map
        map.style.display = 'none';

        // starts the background animation
        sweepRepeat(planet, planets[0].colorLow, planets[0].colorHigh); // sweep background color for green planet

        // shows the starting lexia
        getNextLexia("lexia-start");
    }

    // picks the next correct lexia
    function getNextLexia(nextLex) {
        // update lexia trackers
        currLexia = nextLex;

        // remove old div and css
        $("#planet").remove();
        $("#hide-lexias-css").remove();

        // add it back
        var planet = document.createElement("div");
        planet.setAttribute("id", "planet");
        document.getElementById("planet-wrapper").appendChild(planet);

        // load the lexias into the wrapper
        $("#planet").load("lexias/" + currPlanet + ".html");

        // hide all lexias except the current one
        onlyShowThisLexia(nextLex);
    }

    // hides all lexias except for the one provided
    function onlyShowThisLexia(lexia) {
        console.log("only show " + lexia);
        var lexiasToHide = lexiaParts.slice();
        lexiasToHide = lexiasToHide.filter(item => item !== lexia);

        var lexiaStr = "";
        lexiasToHide.forEach(function(lex) {
           lexiaStr += ("#" + lex + ", ");
        });
        lexiaStr = lexiaStr.substr(0, lexiaStr.length - 2) + " { display: none; } #planet { display: block; }";
        console.log("use this css: " + lexiaStr);

        var css = document.createElement("style");
        css.type = "text/css";
        css.id = "hide-lexias-css";
        css.innerHTML = lexiaStr;
        document.head.appendChild(css);
        // document.getElementById("planet").appendChild(css);
    }

    // called when the user clicks a link in a lexia
    function clickLexia(nextLex) {
        // if the user clicks to go back to the map
        if (nextLex === "lexia-back") {
            // find next planet's index
            var nextIndex = planets.map(function(x) {return x.name; }).indexOf(currPlanet) + 1;
            nextIndex = (nextIndex >= planets.length) ? nextIndex -1 : nextIndex; // make sure it doesn't break after completing last planet

            // assign the next planet
            currPlanet = planets[nextIndex].name;
            setMapImage(nextIndex);
            // go to the planet
            goToMap();
        }
        // if the user clicks a link between lexias
        else {
            getNextLexia(nextLex);
        }
    }

    // loops background color (not working)
    function sweepRepeat(target, startColor, endColor) {
        var forward = sweep(target, 'backgroundColor', startColor, endColor, {duration: 5000});
        /*
        for (i=0; i<100; i++) {
            var forward = sweep(target, 'backgroundColor', startColor, endColor, {duration: 5000});
            setTimeout(function(){
                console.log('done');
            }, 3000)
            console.log("wow");
            // var backward = sweep(target, 'backgroundColor', endColor, startColor, {duration:5000, space:'RGB'});
        }
        */
        //, callback:sweepRepeat(target, endColor, startColor)
    }

    // triggered when the user clicks the 'back to map' button
    function returnToMap() {
        document.getElementById("map").style.display = 'block';
    }

    // runs the auto run function after the DOM is ready (compatible with most browsers)
    if (document.addEventListener) document.addEventListener("DOMContentLoaded", autorun, false);
    else if (document.attachEvent) document.attachEvent("onreadystatechange", autorun);
    else window.onload = autorun;
</script>
</body>
</html>
